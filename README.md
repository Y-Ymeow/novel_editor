# AI 小说创作助手

一个基于 React 的长篇小说创作辅助工具，利用 AI 帮助用户进行小说创作、人物设定和章节管理。

## 🌟 功能特性

### 📖 小说管理
- 创建和管理多部小说
- 为每部小说设置标题和简介
- 支持小说的导入和导出

### 👤 人物管理
- 创建详细的人物卡片（姓名、性别、性格、背景、人际关系等）
- **摘要功能**：为人物创建简洁的摘要，用于上下文参考，节省token
- **批量创建**：支持 AI 批量生成多个人物设定（使用工具调用，无需JSON解析）
- 支持使用 AI 一键生成人物设定
- 历史记录功能，方便快速修改

### 📝 章节编辑
- 章节列表管理，支持拖拽排序
- **批量创建**：支持 AI 批量生成多个章节大纲（使用工具调用，无需JSON解析）
- 章节描述功能，用于指导 AI 生成内容（400-600字详细大纲）
- 全屏编辑模式，提供更好的写作体验
- AI 辅助生成章节内容
- 自动滚动到最新生成的内容
- 保存状态提示（有未保存更改时按钮变色）

### 🤖 AI 功能
- **多API提供商支持**：
  - OpenAI
  - Groq
  - 智谱AI
  - Cerebras
  - Gemini
  - 自定义（兼容OpenAI接口）
- **智能模型管理**：
  - 自动从API获取可用模型列表
  - 支持手动添加模型
  - 可配置模型是否支持思考、工具调用等能力
  - Base URL可修改，支持代理配置
- **思考模式支持**：
  - 基于provider动态控制思考参数
  - Groq：支持reasoning_format、reasoning_effort等参数
  - Cerebras：支持reasoning_effort和disable_reasoning参数
  - 智谱AI：支持thinking参数
  - OpenAI：支持reasoning_effort参数
- **全局模型参数**：
  - Temperature（温度）
  - Top P
  - Frequency Penalty（频率惩罚）
  - Presence Penalty（存在惩罚）
- **工具调用（Function Calling）**：
  - 批量创建人物使用create_characters工具
  - 批量创建章节使用create_chapters工具
  - 无需复杂的JSON解析，更可靠
- **上下文参考功能**：
  - 可选择人物和章节作为上下文参考
  - **摘要/全文模式切换**：可选择使用人物/章节的摘要（节省token）或完整内容（更精确）
- 支持流式输出，实时显示生成内容
- 自定义 Prompt 模板

### 💾 数据存储
- LocalStorage：浏览器本地存储（默认）
- IndexedDB：浏览器数据库存储
- MongoDB：外部数据库存储
- 支持数据备份和恢复

### 📱 响应式设计
- 桌面端：左右分栏布局
- 移动端：抽屉式章节列表

## 🚀 快速开始

### 安装依赖

```bash
npm install
```

### 启动开发服务器

```bash
npm run dev
```

### 构建生产版本

```bash
npm run build
```

### 预览生产版本

```bash
npm run preview
```

## 📖 使用指南

### 1. 配置 API

1. 进入"设置"页面
2. 选择"API 配置"标签
3. 点击"+ 添加 API"
4. 选择API提供商（OpenAI、Groq、智谱AI、Cerebras、Gemini等）
5. 填写API名称、Base URL（支持代理）和API Key
6. 点击"获取模型列表"自动获取可用模型，或手动添加模型
7. 配置模型参数：
   - 是否支持思考
   - 是否支持工具调用
   - 最大Token数
8. 选择默认模型并保存

### 2. 配置全局模型参数

1. 进入"设置"页面
2. 选择"模型参数"标签
3. 调整全局参数：
   - Temperature（温度）：控制输出的随机性
   - Top P：核采样参数
   - Frequency Penalty（频率惩罚）：减少重复内容
   - Presence Penalty（存在惩罚）：鼓励谈论新话题
4. 保存配置

### 3. 创建小说

1. 进入"小说管理"页面
2. 点击"+ 新建小说"
3. 填写小说标题和简介
4. 保存后即可开始创作

### 4. 管理人物

1. 进入"人物卡片"页面
2. 点击"+ 新建人物"或"🤖 批量创建"
3. 手动填写或使用 AI 生成人物设定
4. **（重要）填写人物摘要**：为人物创建简洁的摘要，便于在AI生成时作为上下文参考
5. 保存人物信息

### 5. 编辑章节

1. 进入"编辑器"页面
2. 点击"+ 添加章节"或"🤖 批量创建"创建新章节
3. 填写章节标题，可手动输入或使用 AI 生成描述
4. 在编辑器中编写内容
5. 使用 AI 辅助生成功能时，可选择上下文参考：
   - **摘要模式**：使用人物摘要和章节简短内容（节省token）
   - **全文模式**：使用完整的人物信息和章节内容（更精确）
6. 启用思考模式（如果模型支持）可获得更深入的推理
7. 保存章节内容

### 6. 自定义 Prompt

1. 进入"设置"页面
2. 选择"Prompt 配置"标签
3. 编辑以下 6 个 Prompt 模板：
   - 生成章节正文
   - 生成章节描述
   - 生成人物设定
   - 生成小说描述
   - 批量创建人物
   - 批量创建章节
4. 点击"保存配置"应用更改
5. 如不满意可点击"恢复默认"（会清除已保存的配置）

## 📋 技术栈

- **前端框架**: React v19.2.0
- **构建工具**: Vite v7.3.0
- **语言**: TypeScript ~5.9.3
- **样式**: Tailwind CSS ^4.1.18
- **路由**: react-router-dom ^7.11.0
- **存储**: LocalStorage / IndexedDB / MongoDB

## 📌 占位符说明

在 Prompt 配置中可以使用以下占位符：

### 生成章节正文
- `{novelTitle}` - 小说标题
- `{novelDescription}` - 小说简介
- `{characters}` - 人物信息
- `{chapterTitle}` - 章节标题
- `{chapterDescription}` - 章节描述
- `{existingContent}` - 已有内容

### 生成章节描述
- `{novelTitle}` - 小说标题
- `{novelDescription}` - 小说简介
- `{chapterTitle}` - 章节标题
- `{previousChapterTitle}` - 上一章标题
- `{previousChapterDescription}` - 上一章描述

### 生成人物
- `{novelTitle}` - 小说标题
- `{novelDescription}` - 小说简介
- `{input}` - 用户输入

### 批量创建人物
- `{novelTitle}` - 小说标题
- `{novelDescription}` - 小说简介
- `{input}` - 用户输入

### 生成小说描述
- `{input}` - 用户输入

### 批量创建章节
- `{novelTitle}` - 小说标题
- `{novelDescription}` - 小说简介
- `{input}` - 用户输入

## 📝 重要说明

### 关于工具调用
- 批量创建人物和章节使用工具调用（Function Calling）而非JSON解析
- 工具调用更可靠，参数有schema验证
- 需要确保选择的模型支持工具调用功能

### 关于思考模式
- 思考模式由provider和模型能力动态控制
- 不同provider使用不同的思考参数
- 启用思考模式可能会增加API调用成本

### 关于知识库系统
本项目**不使用传统的知识库检索系统**，而是通过上下文参考功能实现AI辅助创作：
- 通过选择人物和章节作为上下文参考来指导AI生成
- 提供摘要/全文模式切换，平衡token使用和生成质量
- 数据直接存储在浏览器或数据库中，无需额外的知识库系统

### 注意事项
- 使用 AI 功能需要配置有效的 API
- 数据默认存储在浏览器中，清除浏览器数据会丢失所有内容
- 建议定期使用导出功能备份数据
- MongoDB 连接需要自行部署数据库
- 不同API提供商的模型能力和参数可能不同

## 📜 许可证

MIT
